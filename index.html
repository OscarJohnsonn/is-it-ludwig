<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Is it Ludwig? </title>
  <link rel="icon" type="image/png" href="favicon.png">
  <!-- Open Graph Meta Tags -->
<meta property="og:title" content="Is it Ludwig?">
<meta property="og:description" content="Find out if Ludwig is live in League of Legends.">
<meta property="og:image" content="https://oscarjohnsonn.github.io/is-it-ludwig/preview.png">
<meta property="og:url" content="https://oscarjohnsonn.github.io/is-it-ludwig/">
<meta property="og:type" content="website">
<!-- Twitter Card -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Is it Ludwig?">
<meta name="twitter:description" content="Find out if Ludwig is live in League of Legends.">
<meta name="twitter:image" content="https://oscarjohnsonn.github.io/is-it-ludwig/preview.png">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4FWWKTJ2GZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-4FWWKTJ2GZ');
  </script>
  <style>
    /* General Page Styling */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1e1e2e;
      color: #ffffff;
      text-align: center;
      padding: 20px;
      margin: 0;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #ffcc00;
    }

    p {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    /* Upload Box */
    .upload-box {
      background-color: #28293d;
      border-radius: 12px;
      padding: 20px;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
    }

    input[type="file"] {
      display: none;
    }

    .file-label {
      display: inline-block;
      background-color: #ff6600;
      color: #ffffff;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-label:hover {
      background-color: #ff4500;
    }

    /* Buttons */
    .btn {
      background-color: #4CAF50;
      color: #ffffff;
      font-size: 1.2rem;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin: 10px;
      transition: 0.3s;
    }
    .btn:hover {
      background-color: #3a9a40;
    }

    /* Result Text */
    .result-container {
      margin-top: 20px;
      font-size: 1.5rem;
    }
    .ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #ff4444;
      animation: pop 0.3s ease-in-out;
    }
    .not-ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #44ff44;
      animation: pop 0.3s ease-in-out;
    }
    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Image Preview */
    .image-preview {
      margin-top: 20px;
    }
    .image-preview img {
      max-width: 300px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
    }

    /* Share Image Options (text, resolution, toggle) */
    .share-controls {
      margin-top: 20px;
      display: none;
    }
    .share-controls label {
      margin-right: 5px;
    }
    .share-controls input[type="text"] {
      font-size: 1rem;
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ccc;
      width: 70%;
      max-width: 400px;
    }
    .share-controls select {
      font-size: 1rem;
      margin-left: 10px;
      padding: 6px;
      border-radius: 4px;
    }
    .share-controls input[type="checkbox"] {
      transform: scale(1.2);
      margin-left: 10px;
      vertical-align: middle;
    }

    /* Final Shared Image Output */
    #share-output-container {
      margin-top: 30px;
      display: none;
    }
    #share-output-container img {
      max-width: 600px;
      width: auto;
      height: auto;
      border: 2px solid #ffffff;
      margin-top: 10px;
    }
  </style>
</head>

<body>

  <h1>Is it Ludwig? 🤔</h1>


  <!-- Upload & Paste -->
  <div class="upload-box">
    <label for="image-input" class="file-label">📂 Choose an Image</label>
    <input type="file" id="image-input" accept="image/*">
    <p>(Or just press <strong>Ctrl+V</strong> to paste an image)</p>
  </div>

  <br>
  <!-- Analyze & Share Buttons -->
  <button class="btn" id="analyze-btn">Analyze</button>
  <button class="btn" id="share-btn" style="display: none;">Share Image</button>

  <!-- Image preview area -->
  <div class="image-preview" id="image-preview"></div>
  <div class="result-container" id="result"></div>

  <!-- Hidden canvas for analysis -->
  <canvas id="image-canvas" style="display: none;"></canvas>

  <!-- Share Image Options -->
  <div class="share-controls" id="share-controls">
    <!-- Editable text -->
    <div>
      <label for="share-text">Edit Text:</label>
      <input type="text" id="share-text" />
    </div>

    <!-- Resolution -->
    <div style="margin-top: 10px;">
      <label for="resolution-select">Resolution:</label>
      <select id="resolution-select">
        <option value="1">Original</option>
        <option value="0.5">Half Size</option>
        <option value="2">Double Size</option>
      </select>
    </div>

    <!-- Toggle ratio -->
    <div style="margin-top: 10px;">
      <label for="include-ratio">Include Ludwig %?</label>
      <input type="checkbox" id="include-ratio" checked />
    </div>

    <br>
    <button class="btn" id="generate-share-btn">Generate Image</button>
    <button class="btn" id="download-share-btn" style="display: none;">Download Image</button>
  </div>

  <!-- Final image container -->
  <div id="share-output-container">
    <h2>Your Shared Image:</h2>
    <img id="share-output" alt="Shared Image" />
  </div>

  <script>
    // DOM elements
    const imageInput           = document.getElementById('image-input');
    const analyzeBtn           = document.getElementById('analyze-btn');
    const shareBtn             = document.getElementById('share-btn');
    const resultElement        = document.getElementById('result');
    const imagePreview         = document.getElementById('image-preview');
    const canvas               = document.getElementById('image-canvas');
    const ctx                  = canvas.getContext('2d');

    const shareControls        = document.getElementById('share-controls');
    const shareTextInput       = document.getElementById('share-text');
    const resolutionSelect     = document.getElementById('resolution-select');
    const includeRatioCheckbox = document.getElementById('include-ratio');
    const generateShareBtn     = document.getElementById('generate-share-btn');
    const downloadShareBtn     = document.getElementById('download-share-btn');

    const shareOutputContainer = document.getElementById('share-output-container');
    const shareOutput          = document.getElementById('share-output');

    // State variables
    let selectedImage     = null;
    let uploadedImageUrl  = null;   // Stores the uploaded image data URL
    let detectionText     = null;   // "THIS IS LUDWIG" or "THIS IS NOT LUDWIG"
    let detectionRatio    = 0;      // e.g., 0.12 for 12%

    // Handle file selection
    imageInput.addEventListener('change', () => {
      if (imageInput.files && imageInput.files[0]) {
        selectedImage = imageInput.files[0];
        displayImage(selectedImage);
      }
    });

    // Handle pasting an image
    document.addEventListener('paste', (event) => {
      const clipboardFiles = event.clipboardData?.files;
      if (clipboardFiles && clipboardFiles.length > 0) {
        const file = clipboardFiles[0];
        if (file.type.indexOf('image') === 0) {
          selectedImage = file;
          displayImage(selectedImage);
        }
      }
    });

    // Function to display the uploaded image
    function displayImage(imageFile) {
      const reader = new FileReader();
      reader.onload = (event) => {
        uploadedImageUrl = event.target.result;
        imagePreview.innerHTML = `<img src="${uploadedImageUrl}" alt="Uploaded Image">`;
        resultElement.textContent = "Image loaded. Click 'Analyze' when ready.";
        // Reset previous share outputs
        shareControls.style.display = "none";
        shareOutputContainer.style.display = "none";
        downloadShareBtn.style.display = "none";
        shareBtn.style.display = "none";
      };
      reader.readAsDataURL(imageFile);
    }

    // Function to convert RGB to HSV
    function rgbToHsv(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const cmax = Math.max(r, g, b), cmin = Math.min(r, g, b);
      const delta = cmax - cmin;
      let h = 0;
      const s = (cmax === 0) ? 0 : delta / cmax;
      const v = cmax;

      if (delta !== 0) {
        if (cmax === r) {
          h = ((g - b) / delta) % 6;
        } else if (cmax === g) {
          h = (b - r) / delta + 2;
        } else {
          h = (r - g) / delta + 4;
        }
      }
      h = Math.round(h * 60);
      if (h < 0) h += 360;
      return [h, s, v];
    }

    // Function to determine if a pixel should be ignored
    function shouldIgnorePixel(r, g, b, a) {
      if (a === 0) return true;                       // Transparent
      if (r === 255 && g === 255 && b === 255) return true; // White
      return false;
    }

    // Function to categorize hue into color buckets
    function getColorBucket(h) {
      // Red range
      if ((h >= 0 && h <= 20) || (h >= 340 && h <= 360)) return 'red';
      // Orange
      if (h >= 21 && h <= 40) return 'orange';
      // Pink
      if (h >= 300 && h <= 340) return 'pink';
      // Green
      if (h >= 80 && h <= 160) return 'green';
      // Blue
      if (h >= 161 && h <= 260) return 'blue';
      return 'other';
    }

    // Handle Analyze button click
    analyzeBtn.addEventListener('click', () => {
      if (!selectedImage) {
        resultElement.textContent = "Please select or paste an image first.";
        return;
      }

      // Hide share output if previously generated
      shareOutputContainer.style.display = "none";
      downloadShareBtn.style.display = "none";

      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          // Draw image onto hidden canvas
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const { data } = ctx.getImageData(0, 0, canvas.width, canvas.height);
          let validPixels   = 0;
          let redCount      = 0; 
          let orangeCount   = 0; 
          let pinkCount     = 0;
          let greenCount    = 0; 
          let blueCount     = 0;

          for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            const a = data[i + 3];

            if (!shouldIgnorePixel(r, g, b, a)) {
              validPixels++;
              const [h] = rgbToHsv(r, g, b);
              const bucket = getColorBucket(h);
              switch (bucket) {
                case 'red':    redCount++;    break;
                case 'orange': orangeCount++; break;
                case 'pink':   pinkCount++;   break;
                case 'green':  greenCount++;  break;
                case 'blue':   blueCount++;   break;
              }
            }
          }

          const ludwigColorCount = redCount + orangeCount + pinkCount;
          const ratio = validPixels ? (ludwigColorCount / validPixels) : 0;
          const threshold = 0.05; // 5%

          let finalText;
          if (ratio < threshold) {
            finalText = `❌ This is NOT Ludwig ❌ (Only ${(ratio*100).toFixed(2)}% red/orange/pink)`;
            detectionText = "THIS IS NOT LUDWIG";
          } else {
            const totalGreenBlue = greenCount + blueCount;
            const totalRedOrange = redCount + orangeCount;
            if (totalGreenBlue > totalRedOrange) {
              finalText = `❌ This is NOT Ludwig ❌ (Green+Blue > Red+Orange)`;
              detectionText = "THIS IS NOT LUDWIG";
            } else {
              finalText = `🔥 This IS Ludwig 🔥 (${(ratio*100).toFixed(2)}% red/orange/pink)`;
              detectionText = "THIS IS LUDWIG";
            }
          }

          detectionRatio = ratio;

          // Show result
          const isLudwig = detectionText.includes("IS LUDWIG");
          resultElement.innerHTML = isLudwig
            ? `<p class="ludwig">${finalText}</p>`
            : `<p class="not-ludwig">${finalText}</p>`;

          // Show Share Image button
          shareBtn.style.display = "inline-block";
        };
        img.src = e.target.result;  // local data URL
      };
      reader.readAsDataURL(selectedImage);
    });

    // Handle Share Image button click
    shareBtn.addEventListener('click', () => {
      // Prefill the share text with detection text
      shareTextInput.value = detectionText || "";
      shareControls.style.display = "block";

      // Hide the Share Image button to prevent multiple clicks
      shareBtn.style.display = "none";
    });

    // Handle Generate Image button click
    generateShareBtn.addEventListener('click', () => {
      if (!uploadedImageUrl) {
        alert("Please upload and analyze an image first.");
        return;
      }

      // Collect user text (or fallback)
      let userText = shareTextInput.value.trim() || detectionText || "YOUR IMAGE HERE";
      // Collect scale
      const scale = parseFloat(resolutionSelect.value) || 1;
      // Whether to include ratio
      const includeRatio = includeRatioCheckbox.checked;

      createShareImage(uploadedImageUrl, userText, scale, includeRatio ? detectionRatio : null)
        .then((finalDataUrl) => {
          // Replace the uploaded image with the generated share image
          imagePreview.innerHTML = `<img src="${finalDataUrl}" alt="Shared Image">`;

          // Show the final shared image container (optional)
          shareOutput.src = finalDataUrl;
          shareOutputContainer.style.display = "block";

          // Show Download Image button
          downloadShareBtn.style.display = "inline-block";

          // Hide share controls to prevent multiple generations
          shareControls.style.display = "none";
        })
        .catch((err) => {
          console.error("Error generating share image:", err);
        });
    });

    // Function to create the share image
    function createShareImage(imgSrc, mainText, scale, ratioOrNull) {
      return new Promise((resolve, reject) => {
        const offscreenCanvas = document.createElement('canvas');
        const offscreenCtx = offscreenCanvas.getContext('2d');
        const baseImage = new Image();

        baseImage.onload = () => {
          // Scale final dimensions
          const finalWidth  = Math.round(baseImage.width  * scale);
          const finalHeight = Math.round(baseImage.height * scale);
          offscreenCanvas.width  = finalWidth;
          offscreenCanvas.height = finalHeight;

          // Draw scaled image
          offscreenCtx.drawImage(baseImage, 0, 0, finalWidth, finalHeight);

          // Font styling
          const baseFontSize = 48;
          const fontSize     = Math.floor(baseFontSize * scale);

          offscreenCtx.font        = `bold ${fontSize}px Impact, sans-serif`;
          offscreenCtx.fillStyle   = 'white';
          offscreenCtx.strokeStyle = 'black';
          offscreenCtx.lineWidth   = 4 * scale;
          offscreenCtx.textAlign   = 'center';

          const xCenter = finalWidth / 2;
          let y = Math.floor(60 * scale);

          // Main text
          offscreenCtx.strokeText(mainText, xCenter, y);
          offscreenCtx.fillText(mainText, xCenter, y);

          // If ratio is provided, add it
          if (ratioOrNull !== null && ratioOrNull > 0) {
            y += Math.floor(60 * scale);
            const ratioStr = `(${(ratioOrNull * 100).toFixed(2)}% Ludwig)`;
            offscreenCtx.strokeText(ratioStr, xCenter, y);
            offscreenCtx.fillText(ratioStr, xCenter, y);
          }

          // Convert to data URL
          try {
            const dataURL = offscreenCanvas.toDataURL('image/png');
            resolve(dataURL);
          } catch (e) {
            reject(e);
          }
        };
        baseImage.onerror = reject;
        baseImage.src     = imgSrc; // local dataURL
      });
    }

    // Handle Download Image button click
    downloadShareBtn.addEventListener('click', () => {
      if (!shareOutput.src) {
        alert("Please generate the image first.");
        return;
      }
      const link = document.createElement('a');
      link.href = shareOutput.src;
      link.download = 'ludwig_image.png';
      document.body.appendChild(link);
      link.click();
      link.remove();
    });
  </script>

</body>
</html>
