<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Is it Ludwig?</title>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4FWWKTJ2GZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-4FWWKTJ2GZ');
  </script>

  <style>
    /* General Page Styling */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1e1e2e;
      color: #ffffff;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #ffcc00;
    }

    p {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    /* Upload Box */
    .upload-box {
      background-color: #28293d;
      border-radius: 12px;
      padding: 20px;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
    }

    input[type="file"] {
      display: none;
    }

    .file-label {
      display: inline-block;
      background-color: #ff6600;
      color: #ffffff;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-label:hover {
      background-color: #ff4500;
    }

    /* Analyze Button */
    button {
      background-color: #4CAF50;
      color: #ffffff;
      font-size: 1.2rem;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: 0.3s;
    }

    button:hover {
      background-color: #3a9a40;
    }

    /* Ludwig Result Styling */
    .result-container {
      margin-top: 20px;
      font-size: 1.5rem;
    }

    .ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #ff4444;
      animation: pop 0.3s ease-in-out;
    }

    .not-ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #44ff44;
      animation: pop 0.3s ease-in-out;
    }

    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Image Display */
    .image-preview {
      margin-top: 20px;
    }

    .image-preview img {
      max-width: 300px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
    }
  </style>
</head>

<body>

  <h1>Is it Ludwig? ü§î</h1>
  <p>Upload or paste an image to find out!</p>

  <div class="upload-box">
    <label for="image-input" class="file-label">üìÇ Choose an Image</label>
    <input type="file" id="image-input" accept="image/*">
    <p>(Or just press <strong>Ctrl+V</strong> to paste an image)</p>
  </div>

  <br>
  <button id="analyze-btn">Analyze</button>

  <!-- Image preview area -->
  <div class="image-preview" id="image-preview"></div>

  <div class="result-container" id="result"></div>

  <canvas id="image-canvas" style="display: none;"></canvas>

  <script>
    const imageInput = document.getElementById('image-input');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultElement = document.getElementById('result');
    const imagePreview = document.getElementById('image-preview');
    const canvas = document.getElementById('image-canvas');
    const ctx = canvas.getContext('2d');

    let selectedImage = null;

    // Handle file selection
    imageInput.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        selectedImage = this.files[0];
        displayImage(selectedImage);
      }
    });

    // Handle pasting an image
    document.addEventListener('paste', function(event) {
      const clipboardFiles = event.clipboardData?.files;
      if (clipboardFiles && clipboardFiles.length > 0) {
        const file = clipboardFiles[0];
        if (file.type.indexOf('image') === 0) {
          selectedImage = file;
          displayImage(selectedImage);
        }
      }
    });

    function displayImage(imageFile) {
      const reader = new FileReader();
      reader.onload = function(event) {
        imagePreview.innerHTML = `<img src="${event.target.result}" alt="Uploaded Image">`;
        resultElement.textContent = "Image loaded. Click Analyze when ready.";
      };
      reader.readAsDataURL(imageFile);
    }

    // Convert RGB to HSV
    function rgbToHsv(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const cmax = Math.max(r, g, b);
      const cmin = Math.min(r, g, b);
      const delta = cmax - cmin;
      let h = 0;
      const s = cmax === 0 ? 0 : delta / cmax;
      const v = cmax;

      if (delta !== 0) {
        if (cmax === r) {
          h = ((g - b) / delta) % 6;
        } else if (cmax === g) {
          h = (b - r) / delta + 2;
        } else {
          h = (r - g) / delta + 4;
        }
      }

      h = Math.round(h * 60);
      if (h < 0) h += 360;
      return [h, s, v];
    }

    // Decide whether to ignore a pixel:
    //   1) Fully transparent (alpha=0)
    //   2) White (r=255, g=255, b=255)
    function shouldIgnorePixel(r, g, b, a) {
      if (a === 0) return true;
      if (r === 255 && g === 255 && b === 255) return true;
      return false;
    }

    // Classify a hue into a color bucket
    function getColorBucket(h) {
      // Red range or near 360
      if ((h >= 0 && h <= 20) || (h >= 340 && h <= 360)) {
        return 'red';
      }
      // Orange range
      if (h >= 21 && h <= 40) {
        return 'orange';
      }
      // Pink-ish range
      if (h >= 300 && h <= 340) {
        return 'pink';
      }
      // Green range (example: 80..160)
      if (h >= 80 && h <= 160) {
        return 'green';
      }
      // Blue range (example: 161..260)
      if (h >= 161 && h <= 260) {
        return 'blue';
      }
      return 'other';
    }

    analyzeBtn.addEventListener('click', function() {
      if (!selectedImage) {
        resultElement.textContent = "Please select or paste an image first.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          // Draw the image on canvas
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          let validPixels = 0;
          let redCount = 0;
          let orangeCount = 0;
          let pinkCount = 0;
          let greenCount = 0;
          let blueCount = 0;

          // Loop over every pixel
          for (let i = 0; i < data.length; i += 4) {
            const r = data[i];
            const g = data[i + 1];
            const b = data[i + 2];
            const a = data[i + 3];

            if (!shouldIgnorePixel(r, g, b, a)) {
              validPixels++;
              const [h] = rgbToHsv(r, g, b);
              const bucket = getColorBucket(h);

              switch (bucket) {
                case 'red':    redCount++;    break;
                case 'orange': orangeCount++; break;
                case 'pink':   pinkCount++;   break;
                case 'green':  greenCount++;  break;
                case 'blue':   blueCount++;   break;
                // 'other' is ignored in the counts
              }
            }
          }

          // Calculate ratio of red/orange/pink
          const ludwigColorCount = redCount + orangeCount + pinkCount;
          const ratio = validPixels ? (ludwigColorCount / validPixels) : 0;

          // If Ludwig color ratio is below threshold, it's not Ludwig
          const threshold = 0.05; // e.g., 5%
          if (ratio < threshold) {
            resultElement.innerHTML = `<p class="not-ludwig">‚ùå This is NOT Ludwig ‚ùå<br>(Only ${(ratio * 100).toFixed(2)}% red/orange/pink)</p>`;
            return;
          }

          // If green+blue > red+orange, also not Ludwig
          const totalGreenBlue = greenCount + blueCount;
          const totalRedOrange = redCount + orangeCount;
          if (totalGreenBlue > totalRedOrange) {
            resultElement.innerHTML = `<p class="not-ludwig">‚ùå This is NOT Ludwig ‚ùå<br>(Green+Blue > Red+Orange)</p>`;
            return;
          }

          // Otherwise, it passes all checks
          resultElement.innerHTML = `<p class="ludwig">üî• This IS Ludwig üî•<br>(${(ratio * 100).toFixed(2)}% red/orange/pink)</p>`;
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(selectedImage);
    });
  </script>

</body>
</html>
