<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Is it Ludwig?</title>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-4FWWKTJ2GZ"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-4FWWKTJ2GZ');
  </script>

  <style>
    /* General Page Styling */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #1e1e2e;
      color: #ffffff;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 3rem;
      margin-bottom: 10px;
      color: #ffcc00;
    }

    p {
      font-size: 1.2rem;
      margin-bottom: 10px;
    }

    /* Upload Box */
    .upload-box {
      background-color: #28293d;
      border-radius: 12px;
      padding: 20px;
      display: inline-block;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.1);
    }

    input[type="file"] {
      display: none;
    }

    .file-label {
      display: block;
      background-color: #ff6600;
      color: white;
      padding: 12px 20px;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.3s;
    }

    .file-label:hover {
      background-color: #ff4500;
    }

    /* Analyze Button */
    button {
      background-color: #4CAF50;
      color: white;
      font-size: 1.2rem;
      padding: 12px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      margin-top: 10px;
      transition: 0.3s;
    }

    button:hover {
      background-color: #3a9a40;
    }

    /* Ludwig Result Styling */
    .result-container {
      margin-top: 20px;
      font-size: 1.5rem;
    }

    .ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #ff4444;
      animation: pop 0.3s ease-in-out;
    }

    .not-ludwig {
      font-size: 2rem;
      font-weight: bold;
      color: #44ff44;
      animation: pop 0.3s ease-in-out;
    }

    @keyframes pop {
      0% { transform: scale(0.8); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    /* Image Display */
    .image-preview {
      margin-top: 20px;
    }

    .image-preview img {
      max-width: 300px;
      border-radius: 10px;
      box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
    }
  </style>
</head>
<body>

  <h1>Is it Ludwig? ü§î</h1>
  <p>Upload or paste an image to find out!</p>

  <div class="upload-box">
    <label for="image-input" class="file-label">üìÇ Choose an Image</label>
    <input type="file" id="image-input" accept="image/*">
    <p>(Or just press <strong>Ctrl+V</strong> to paste an image)</p>
  </div>

  <br>
  <button id="analyze-btn">Analyze</button>

  <!-- Image preview area -->
  <div class="image-preview" id="image-preview"></div>

  <div class="result-container" id="result"></div>

  <canvas id="image-canvas" style="display: none;"></canvas>

  <script>
    const imageInput = document.getElementById('image-input');
    const analyzeBtn = document.getElementById('analyze-btn');
    const resultElement = document.getElementById('result');
    const imagePreview = document.getElementById('image-preview');
    const canvas = document.getElementById('image-canvas');
    const ctx = canvas.getContext('2d');

    let selectedImage = null;

    // Handle file selection
    imageInput.addEventListener('change', function() {
      if (this.files && this.files[0]) {
        selectedImage = this.files[0];
        displayImage(selectedImage);
      }
    });

    // Handle pasting an image
    document.addEventListener('paste', function(event) {
      const clipboardFiles = event.clipboardData?.files;
      if (clipboardFiles && clipboardFiles.length > 0) {
        const file = clipboardFiles[0];
        if (file.type.indexOf('image') === 0) {
          selectedImage = file;
          displayImage(selectedImage);
        }
      }
    });

    function displayImage(imageFile) {
      const reader = new FileReader();
      reader.onload = function(event) {
        imagePreview.innerHTML = `<img src="${event.target.result}" alt="Uploaded Image">`;
      };
      reader.readAsDataURL(imageFile);
      resultElement.textContent = "Image loaded. Click Analyze when ready.";
    }

    function rgbToHsv(r, g, b) {
      r /= 255; g /= 255; b /= 255;
      const cmax = Math.max(r, g, b), cmin = Math.min(r, g, b), delta = cmax - cmin;
      let h = 0, s = cmax ? delta / cmax : 0, v = cmax;

      if (delta) {
        if (cmax === r) h = ((g - b) / delta) % 6;
        else if (cmax === g) h = (b - r) / delta + 2;
        else h = (r - g) / delta + 4;
        h = Math.round(h * 60);
        if (h < 0) h += 360;
      }
      return [h, s, v];
    }

    function shouldIgnorePixel(r, g, b, a) {
      return a === 0 || (r === 0 && g === 0 && b === 0) || (r === 255 && g === 255 && b === 255);
    }

    analyzeBtn.addEventListener('click', function() {
      if (!selectedImage) {
        resultElement.textContent = "Please select or paste an image first.";
        return;
      }

      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          ctx.drawImage(img, 0, 0);

          const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
          const data = imageData.data;

          let validPixels = 0, redPixels = 0, orangePixels = 0, pinkPixels = 0;

          for (let i = 0; i < data.length; i += 4) {
            const r = data[i], g = data[i + 1], b = data[i + 2], a = data[i + 3];

            if (shouldIgnorePixel(r, g, b, a)) continue;
            validPixels++;

            const [h, s, v] = rgbToHsv(r, g, b);

            if ((h >= 0 && h <= 20) || (h >= 340 && h <= 360)) redPixels++;
            else if (h >= 21 && h <= 40) orangePixels++;
            else if (h >= 300 && h <= 340) pinkPixels++;
          }

          let ludwigDetected = redPixels >= 20 || orangePixels >= 20 || pinkPixels >= 20;
          resultElement.innerHTML = ludwigDetected
            ? `<p class="ludwig">üî• This IS Ludwig üî•</p>`
            : `<p class="not-ludwig">‚ùå This is NOT Ludwig ‚ùå</p>`;
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(selectedImage);
    });
  </script>

</body>
</html>
